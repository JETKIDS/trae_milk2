# Server Notes

重要仕様（配達パターン更新）

- 終了日短縮（解約）
  - 旧終了日が無期限（null）の場合も「短縮」として扱う
  - 既存期間に含まれる確定月のうち、最新の確定月より前の終了日は不可
  - 最新の確定月と同月、またはそれ以降の終了日への短縮は許可

- 終了日延長（解約取り消し／無期限へ戻す）
  - 新たに追加される範囲（旧終了日の翌月〜新終了日の月）に確定月が含まれる場合は不可
  - 上記範囲に確定がなければ延長は許可

変更に関する運用ルール

- 上記ロジックはオーナー承認済みの仕様です。変更・撤回・拡張を行う場合は、必ず事前にオーナーの承認を得てください。

回帰テスト

- `server/test_delivery_patterns_update.js` を用意しています。ローカルでサーバーを起動後（デフォルトポート: 9000）、このスクリプトを実行すると、短縮／延長の挙動が期待どおりか検証できます。