# 旧 Express API 移植対象リスト（暫定）

Next.js + Supabase へ移植すべき旧 API を整理したチェックリストです。進捗状況に応じて更新してください。

---

## 1. 完了済み／着手済み
- 顧客関連：請求確定／解除、入金、カレンダー、臨時変更、AR サマリー
- 臨時変更 Undo（基礎実装）

---

## 2. 移植対象（未着手）

| 区分 | 旧ルート | 内容 | 優先度（初期案） |
|------|----------|------|----------------|
| マスター管理 | `routes/masters.js` | コース／スタッフ／メーカー／会社情報／収納機関等の CRUD | 高（設定変更が頻繁） |
| 商品マスター | `routes/products.js` | 商品一覧・詳細・登録・更新・削除 | 高 |
| コース管理 | `routes/courses.js` | コース一覧・登録・更新・削除 | 中 |
| 配達パターン管理 | `routes/deliveryPatterns.js` | 顧客別パターン取得・登録・更新・削除・トグル | 中 |
| 分析系 | `routes/analyses.js` | 売上分析、商品別売上、コース別売上、新規・解約顧客、KPI | 中〜低（次フェーズで検討） |
| バッチ処理 | `routes/bulkUpdate.js` | 増配処理、価格変更、ロールバック、ログ取得 | 中 |
| 配達リスト | `routes/delivery.js` | 日次配達リスト、期間配達、商品サマリー | 中 |
| バッチ帳票 | `routes/debits.js` | 口座振替用ファイル生成（`/generate`） | 低（機能状況要確認） |

---

## 3. 補足メモ
- Undo 対応が必要な API は、移植時に `undo_stack` と RPC を利用するよう再設計する。
- 分析系・バッチ処理は Supabase RPC や Edge Functions を活用することを検討。
- マスター編集系は認証・権限管理の導入も視野に入れて設計する。

---

## 4. 次のアクション例
- 優先度をつけて順次移植（例：マスター管理 → 商品 → 分析 → バッチ処理）。
- RPC／Route Handler で必要になる補助 SQL（ビューや集計関数）を `schema.sql` に追加。
- フロントエンドで利用するページ／モーダルを洗い出し、Next.js 版で再構築する。

